#!/bin/bash

# Rusty Sbar Setup Script
# This script sets up the Rust SketchyBar configuration

set -e

echo "ðŸ¦€ Setting up Rusty Sbar..."

# Check if we're in the right directory
if [ ! -f "Cargo.toml" ]; then
    echo "âŒ Error: Please run this script from the sbar-rs directory"
    exit 1
fi

# Build the project
echo "ðŸ”¨ Building Rust project..."
cargo build --release

# Create SketchyBar config directory if it doesn't exist
SKETCHYBAR_CONFIG_DIR="$HOME/.config/sketchybar"
mkdir -p "$SKETCHYBAR_CONFIG_DIR"

# Create the sketchybarrc file
echo "ðŸ“ Creating SketchyBar configuration..."
cat > "$SKETCHYBAR_CONFIG_DIR/sketchybarrc" << EOF
#!/bin/bash

# Rusty Sbar - SketchyBar configuration in Rust
# Generated by setup.sh

exec "$PWD/target/release/sketchybar-config"
EOF

# Make it executable
chmod +x "$SKETCHYBAR_CONFIG_DIR/sketchybarrc"

echo "âœ… Setup complete!"
echo ""
echo "ðŸ“‹ Next steps:"
echo "1. Restart SketchyBar: brew services restart sketchybar"
echo "2. Check logs if needed: tail -f /tmp/sketchybar_*.log"
echo ""
echo "ðŸŽ¨ Your new Rust-powered SketchyBar is ready!"
echo "   - Multi-display support âœ“"
echo "   - Real-time clock updates âœ“"
echo "   - Battery monitoring âœ“"
echo "   - Catppuccin theme âœ“"
echo ""
echo "ðŸ”§ To customize, edit the Rust source files and run:"
echo "   cargo build --release && brew services restart sketchybar"
